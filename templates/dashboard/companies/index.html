{% extends "dashboard/base.html" %} {% block title %}企業情報一覧{% endblock %}
{% block head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard/companies/index.css') }}"
/>
{% endblock %} {% block content %}

<div class="companies-page">
    <div class="search-container">
        <div class="search-wrapper">
            <div class="search-content">
                <p>企業名で検索</p>
                <div class="search-divider"></div>                
                <img src="/static/auth/image/favicon/favicon.png" />
            </div>
        </div>
    </div>
        
    
    <div class="company-list-container">
        <div class="company-list-wrapper">
            <div class="company-list-content">
                <table class="companies-table">
                    <colgroup>
                        <col />
                        <col />
                        <col />
                        <col />
                        <col />
                        <col />            
                    </colgroup>
                    <thead>
                        <tr>
                        <th class="mailStatus">メール</br>送付有無</th>
                        <th class="id">ID</th>
                        <th class="companyName">企業名</th>
                        <th class="companySite">企業HP</th>
                        <th class="inquiryUrl">お問い合わせURL</th>
                        <th class="savedDate">保存日</th>
                        </tr>
                    </thead>
                    
                    <tbody id="companies-tbody"></tbody>
                    
                </table>
            </div>
        </div>
    </div>

    <div class="pagination-list-container">
        <div class="pagination-list-wrapper">
            <div class="pagination-list-content">
                <nav
                class="pager"
                id="companies-pager"
                aria-label="ページ切替"
                ></nav>
            </div>
        </div>
    </div>

    <div class="page-top-container">
        <div class="page-top-wrapper">
            <div class="page-top-content">
                <img src="/static/auth/image/page-top-button.png" />
            </div>
        </div>
    </div>
</div>


<script>
  const pages = [
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ],
    [
        {
            mailStatus: "□",
            id: "1234",
            companyName: "株式会社創伸建設〇〇株式会社創伸建設〇〇...",
            companySite: "https://k-soush...",
            inquiryUrl: "https://k-soush...",
            savedDate: "yyyy/mm/dd",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        },
        {
            mailStatus: "□",
            id: "",
            companyName: "",
            companySite: "",
            inquiryUrl: "",
            savedDate: "",
        }
    ]    
  ];

  const tbody = document.getElementById("companies-tbody");
  const pagerEl = document.getElementById("companies-pager");
  let page = 1;
  const totalPages = pages.length;

  const rowHTML = (r) =>
    `<tr>
    <td>${r.mailStatus || ""}</td>
    <td>${r.id || ""}</td>
    <td>${r.companyName || ""}</td>
    <td>${r.companySite || ""}</td>
    <td>${r.inquiryUrl || ""}</td>
    <td>${r.savedDate || ""}</td>
  </tr>`;

  function renderTable(page1) {
    const rows = pages[page1 - 1] ?? [];
    tbody.innerHTML = rows.map(rowHTML).join("");
  }

  function buildPagerHTML(page1, total) {
    const parts = [];
    if (page1 > 1)
      parts.push(
        `<a class="search-list-pagination pager-btn" data-page="${
          page1 - 1
        }" href="#top">< 前へ</a>`
      );
    for (let p = 1; p <= total; p++) {
      const isNearStart = page1 <= 3 && p <= 5;
      const isNearEnd = page1 >= total - 2 && p >= total - 4;
      const inWindow =
        p === 1 || p === total || (p >= page1 - 2 && p <= page1 + 2);
      if (isNearStart || isNearEnd || inWindow) {
        parts.push(
          p === page1
            ? `<span class="current">${p}</span>`
            : `<a class="search-list-pagination" data-page="${p}" href="#top">${p}</a>`
        );
      } else if (p === 2 && page1 > 4) {
        parts.push(`<span class="dots">...</span>`);
      } else if (p === total - 1 && page1 < total - 3) {
        parts.push(`<span class="dots">...</span>`);
      }
    }
    if (page1 < total)
      parts.push(
        `<a class="search-list-pagination pager-btn" data-page="${
          page1 + 1
        }" href="#top">次へ ></a>`
      );
    return parts.join("");
  }

  function renderPager() {
    pagerEl.innerHTML = buildPagerHTML(page, totalPages);
  }

  pagerEl.addEventListener("click", (e) => {
    const a = e.target.closest(".search-list-pagination");
    if (!a) return;
    const to = Number(a.dataset.page);
    if (!Number.isFinite(to) || to < 1 || to > totalPages) return;
    page = to;
    renderTable(page);
    renderPager();
  });

  renderPager();
  renderTable(page);
</script>
{% endblock %}
