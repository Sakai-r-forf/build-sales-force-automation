{% extends "dashboard/base.html" %} 
{% block title %}建設業 企業情報スクレイパー{% endblock %} 
{% block head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard/scraping/index.css') }}"
/>
{% endblock %} {% block content %}

<div class="scraping-container">
  <div class="scraping-wrapper">
    <div class="scraping-content">
      <form method="POST" action="{{ url_for('scraping.crawl') }}">
        <label>企業掲載サイトのURL</label>
        <input
          required
          name="seed_url"
          placeholder="https://example.com/member"
        />
        <p class="faq-link">
          企業一覧が掲載されているサイトのURLを入力してください<a
            href="{{ url_for('faq.index') }}"
            >（詳細はこちら）</a
          >
        </p>

        <label>抽出範囲の制限（空欄可）</label>
        <input name="allowed_domain" placeholder="example.com" />
        <p class="faq-link">
          空欄の場合、上記サイト内のみから情報を抽出します<a
            href="{{ url_for('faq.index') }}"
            >（詳細はこちら）</a
          >
        </p>

        <div class="flex">
          <div class="flex-2">
            <label>最大取得件数</label>
            <input
              name="limit"
              type="number"
              min="1"
              max="500"
              value="100"
              placeholder="既定値：100"
            />
            <p class="faq-link">
              サイトから抽出する企業数の上限を設定します</br>
              <a
                href="{{ url_for('faq.index') }}"
                >（詳細はこちら）</a
              >
            </p>
          </div>

          <div class="flex-2">
            <label>最大取得ページ数</label>
            <input
              name="max_pages"
              type="number"
              min="1"
              max="2000"
              value="100"
              placeholder="既定値：100"
            />
            <!-- TODO FAQリンク挿入 -->
            <p class="faq-link">
              サーバー負荷軽減のための制限数です</br>
              <a
                href="{{ url_for('faq.index') }}"
                >（詳細はこちら）</a
              >
            </p>
          </div>
        </div>

        <label>絞り込みキーワード</label>
        <textarea
          id="jp_keywords"
          name="jp_keywords"
          rows="4"
          placeholder="株式会社,有限会社,建設,工務店,お問い合わせ,会社概要"
        ></textarea>
        <p class="faq-link">
          企業名や業種に関連するキーワードを1ワード毎に「,」で区切り入力をしてください<a
            href="{{ url_for('faq.index') }}"
            >（詳細はこちら）</a
          >
        </p>

        <button type="submit">CSVを生成</button>
        <p class="hint">※ CSV生成の目安は5分前後です</p>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const textarea = document.getElementById("jp_keywords");
  if (!textarea) return;

  let composing = false;

  textarea.addEventListener("compositionstart", () => composing = true);
  textarea.addEventListener("compositionend", () => composing = false);

  textarea.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {

      if (composing) return;

      e.preventDefault();

      const s = textarea.selectionStart;
      const ePos = textarea.selectionEnd;
      const v = textarea.value;

      textarea.value = v.slice(0, s) + ",\n" + v.slice(ePos);
      textarea.selectionStart = textarea.selectionEnd = s + 2;
    }
  });
  /* 必要になったら使用する。
    textarea.addEventListener("input", () => {
      if (composing) return;

      textarea.value = textarea.value
        .replace(/[ 、。\.\/\\・　]/g, ",") 
        .replace(/,+/g, ",");
    });
  */
});
</script>

{% endblock %}
